includeConfig "${projectDir}/conf/base.config"
params {
    sample_sheet = "samplesheet.csv"
    basecall_model = "dna_r10.4.1_e8.2_400bps_sup@v5.2.0"
    basecall_modifications = "5mCG_5hmCG"
    reference = "GrCh38.fa"
    regions_bed = "regions.bed"
    outdir = "results"
}

profiles {
    hpc {
        process {
            executor = 'slurm'
            queue = 'mpcs.p'
            cpus = { 2 * task.attempt }
            memory = { 16.GB * task.attempt }
            time = { 7.d * task.attempt }
            withName: 'ONT_BASECALL' {
                queue = 'mpcg.p'
                clusterOptions = '--gpus-per-node=4'
                cpus = { 16 * task.attempt }
                memory = { 96.GB * task.attempt }
                time = { 7.d * task.attempt }
            }
            withName: 'ALIGNMENT|METHYLATION_CALL|VARIANT_CALL' {
                queue = 'mpcs.p'
                cpus = { 16 * task.attempt }
                memory = { 128.GB * task.attempt }
                time = { 7.d * task.attempt }
            }
            withName: 'SPLIT_BAM' {
                queue = 'mpcs.p'
                cpus = { 16 * task.attempt }
                memory = { 64.GB * task.attempt }
                time = { 7.d * task.attempt }
            }
        }
        workDir = "${System.getenv('WORK')}/ont-methpro_work"
        singularity.enabled = true
        singularity.autoMounts = true
        singularity.cacheDir = "${projectDir}/container"
        singularity.pullTimeout = '1h'
        singularity.runOptions = '--nv'
        docker.enabled = false
        apptainer.enabled = false
    }
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
        singularity.enabled = false
        apptainer.enabled = false
    }
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        singularity.cacheDir = "${projectDir}/container"
        docker.enabled = false
        apptainer.enabled = false
    }
    apptainer {
        apptainer.enabled = true
        apptainer.autoMounts = true
        apptainer.cacheDir = "${projectDir}/container"
        docker.enabled = false
        singularity.enabled = false
    }
}
